---
title: 存储器管理
date: 2017/06/17
categories:
- Network
tags:
- computer
- IO
- Netty
- Network
---

## 前言
存储器是计算机系统的重要组成部分。在理想情况下存储器的速度应当非常快，能跟上处理器的速度，容量大而且价格也非常便宜，但目前无法同时满足
这三个条件。这可以说是在存储器领域的CAP理论了。因此如何对它加以有效的管理，不仅直接影响到存储器的利用率，而且还能对系统性能有重大影响。

## 多级存储器结构
在现代的计算机中，存储层次根据具体的功能分工细化为寄存器、高速缓存、主存储器、磁盘缓存、固定磁盘、可移动存储介质等6层。越靠近CPU的地方
存储介质的访问速度越快，价格越高，相应的容量也越小。如图所示：

在存储层次中，寄存器和主存储器又被称为可执行存储器，相比较于外存，计算机所采用的访问机制与时间均是不同的。进程可以在很少的时钟周期内使用
一条load或者store指令对可执行存储器进行访问，但对外存的访问则需要通过I/O设备来实现，其中又涉及到中断、设备驱动程序，以及物理设备的运行，
所需时间远远高于对可执行器的访问。

1. 寄存器：寄存器的访问速度最快，一般以字(word)为单位，比如32位寄存器，64位寄存器。根据功能的不同又可以划分为不同的种类，比如指令寄存器、
标志位寄存器、循环控制寄存器、条件操作寄存器、地址转换寄存器、用于栈操作的栈寄存器等，如ax,bx,cx,sp等。

2. 高速缓存：高速缓存的容量大于或者远大于寄存器，而比主存储器要小不小，但是速度快于主存储器，它与寄存器的存在主要是缓和CPU指令执行的速度与
访问内存的速度这一矛盾。根据程序执行的局部性原理，将主存中一些经常访问的程序或数据放在高速缓存中，减少访问主存储器的次数，可大幅度提高程序
执行的速度。在现代的计算机系统中，一般还分为多级高速缓存，如L1、L2、L3 Cache等。

3. 主存储器：主要来保存进程运行时的程序和数据信息，它是一般意义上的内存。CPU控制部件只能从主存中获取程序和数据，与外部设备的交互也必须通过
内存的地址空间来完成。

4. 磁盘缓存：由于目前磁盘的I/O速度远低于对主存的访问速度，因此将频繁使用的一部分磁盘数据和信息，暂时存放在磁盘缓存中，可减少访问磁盘的次数，
从而提高系统的I/O性能。磁盘缓存本身并不是一种实际的存储介质，它只是利用主存中的存储空间，来充当中间人的角色，可以实现成组提交等。

## 存储器的管理
操作系统的存储管理，负责对可执行存储器的分配、回收以及提供在存储层次间数据移动的管理机制。

## 内存分配方式
程序执行时需要从外存上被加载到内存才能被OS调度执行，对于内存的分配方式不同，对OS的性能也会产生很大的影响。

### 单一连续分配
这是最简单的一种存储管理方式，但只能用于单用户、单任务的操作系统中。在这种分配方式中，可把内存分为系统区(Kenel Space)和用户区(User Space)，系统区
仅提供给OS使用，通常放在内存低地址部分；用户区是指系统区以外的全部内存空间，提供给用户使用。

### 固定分区分配
固定分区式分配是最简单的一种可以运行多道程序的存储管理方式。它是将内存用户空间划分为若干固定大小的区域，每个分区中只装入一道作业，从而实现用户空间的
多道作业并发运行。

1. 划分分区的方法：分区大小相等，即使所有的内存分区大小相等，其缺点是缺乏灵活性。大了空间浪费，小了程序运行不了；分区大小不等，为了克服
分区大小相等而缺乏灵活性这个缺点，可把内存划分成含有多个较小分区，适量中等分区以及少量大分区，从而根据程序的大小为之分配适当的分区。
2. 内存分配：为了便于分配，可以将分区大小进行排队，并为之建立一张分区使用表，其中各表项包括每个分区的起始地址、大小及状态（是否分配）。

![](/source/images/2017-06/mm_2.png)

### 动态分区分配
动态分区分配是根据进程的实际需要，动态地为之分配内存空间。在实现可变分区分配时，将涉及到分区分配中所用的数据结构、分区分配算法和分区的分配与回收操作这样三个问题。
#### 分区分配中的数据结构
为了实现分区分配，系统中必须配置相应的数据结构，用来描述空闲分区和已分配分区的情况，为分配提供依据。常用的数据结构有以下两种形式:
1. 空闲分区表。在系统中设置一张空闲分区表，用于记录每个空闲分区的情况。每个 空闲分区占一个表目，表目中包括分区序号、分区始址及分区的大小等数据项。
